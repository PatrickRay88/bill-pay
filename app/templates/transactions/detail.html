{% extends 'base.html' %}
{% block content %}
<div class="container py-3">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h2>Transaction</h2>
    <a href="{{ url_for('transactions.index') }}" class="btn btn-sm btn-secondary">Back</a>
  </div>
  <div class="card mb-3">
    <div class="card-body">
      <h5 class="card-title mb-1">{{ transaction.name }}</h5>
      {% if transaction.merchant_name %}<div class="small text-muted mb-2">Merchant: {{ transaction.merchant_name }}</div>{% endif %}
      <p class="mb-2">
        <strong class="{% if transaction.amount > 0 %}text-danger{% else %}text-success{% endif %}">
          {{ transaction.amount | round(2) }}
        </strong>
        on {{ transaction.date }} via account #{{ account.id }}
      </p>
      {% if transaction.category %}<p class="mb-2"><span class="badge bg-primary">{{ transaction.category }}</span></p>{% endif %}
      {% if transaction.location %}<p class="mb-2 small text-muted">Location: {{ transaction.location }}</p>{% endif %}
      <div class="mb-3">
        <label class="form-label small">Notes</label>
        <textarea id="txn-notes" class="form-control" rows="3">{{ transaction.notes or '' }}</textarea>
        <button class="btn btn-sm btn-outline-primary mt-2" id="save-notes-btn">Save Notes</button>
      </div>
    </div>
  </div>
</div>
{% endblock %}
{% block scripts %}
<script>
  document.getElementById('save-notes-btn').addEventListener('click', function() {
  fetch("{{ url_for('transactions.edit_note', transaction_id=transaction.id) }}", {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'X-CSRFToken': document.querySelector('meta[name="csrf-token"]').getAttribute('content')
      },
      body: JSON.stringify({ notes: document.getElementById('txn-notes').value })
    }).then(r => r.json()).then(data => {
      if (data.success) {
        alert('Notes saved');
      }
    });
  });
</script>
{% endblock %}
